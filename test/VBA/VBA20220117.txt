Option Explicit
Public Sub リスト作成()

    Dim Lost_Row As Long
    Dim TempData
    Dim ws As Worksheet
    Dim da As Worksheet
    
    
    Dim sheet As Worksheet
    Set sheet = ActiveSheet ' 現在アクティブなシートを取得する1
    
    Debug.Print "start"
    
    'シートがあるかどうか調べて、ある場合はそのシートを削除
    Delete_sheet
    
    'dateシート作成
    Worksheets.Add After:=Worksheets(Worksheets.COUNT)
    ActiveSheet.Name = "date"
    sheet.Activate
    

    Set ws = ThisWorkbook.Worksheets("Master")
    'Set kp = ThisWorkbook.Worksheets("KDDI_KPIList")
    Set da = ThisWorkbook.Worksheets("date")
    
    '最終行を所得
    Lost_Row = Worksheets("Master").Cells(3, 1).End(xlDown).Row

    'コピー用データ取得
    TempData = ws.Range(ws.Cells(3, 1), ws.Cells(Lost_Row, 15)).Value
    
'    Debug.Print 2
'    kp.Range(kp.Cells(2, 1), kp.Cells((Lost_Row - 1), 15)).Value = TempData
'
    'detaシートにコピー
    da.Range(da.Cells(1, 1), da.Cells((Lost_Row - 2), 15)).Value = TempData
    

    'データ削除試作品１
    'データ削除

    
    'データ削除試作品
Debug.Print 1

    'Call データ削除試作品3(Lost_Row)
    
    Call データ削除試作品4(Lost_Row)

    '半角スペースを削除し詰める
    '半角スペース削除()
    Call O列の幅を調整



'Application.DisplayAlerts = False ' メッセージを非表示
'Sheets("date").Delete ' シート「データ」を削除

Debug.Print "end"

End Sub
'データ削除試作品4
Public Sub データ削除試作品4(Lost_Row As Long)
    Dim da As Worksheet
    Dim i As Long
    Dim x As Long
    Dim COUNT As Long
    Dim MyArray As Variant
    
     'RegExpオブジェクトの作成

    COUNT = Lost_Row - 2
    Set da = ThisWorkbook.Worksheets("date")
    MyArray = da.Range(da.Cells(1, 15), da.Cells(COUNT, 15))
    
    Debug.Print "???"
    
    
    Dim RE, reMatch
    Dim Calendar As Object
    Set Calendar = CreateObject("VBScript.RegExp")
    
      

    
        '正規表現の指定
    With Calendar
        .Global = True      '文字列全体を検索するか(True)、しないか(False)
        .IgnoreCase = False '大文字と小文字を区別するか(False)、しないか(True)
        .Pattern = "\d{4}/\d{2}/\d{2}"  'パターンを指定

        For i = LBound(MyArray) To UBound(MyArray)
           
            MyArray(i, 1) = Calendar.Replace(MyArray(i, 1), MyArray(i, 1), vbLf)
        
        Next i

    End With
    
    
    
    
    da.Range(da.Cells(1, 15), da.Cells(COUNT, 15)) = MyArray
 
End Sub
'データ削除試作品３
Public Sub データ削除試作品3(Lost_Row As Long)
    Dim da As Worksheet
    Dim i As Long
    Dim x As Long
    Dim COUNT As Long
    Dim MyArray As Variant
    
     'RegExpオブジェクトの作成

    COUNT = Lost_Row - 2
    Set da = ThisWorkbook.Worksheets("date")
    MyArray = da.Range(da.Cells(1, 15), da.Cells(COUNT, 15))
    
    Debug.Print "???"
    


    For i = LBound(MyArray) To UBound(MyArray)
       
        MyArray(i, 1) = Calendar.Replace(MyArray(i, 1), MyArray(i, 1), vbLf)
          MyArray(i, 1) = Replace(MyArray(i, 1), "100~*", "")
        For x = 0 To 200
             MyArray(i, 1) = Replace(MyArray(i, 1), STR(x) + " ", vbLf, vbTextCompare)
             'MyArray(i, 1) = Replace(MyArray(i, 1), STR(x) + "~*", vbLf, vbTextCompare)
        Next x

        If MyArray(i, 1) = "NR_" + " " Then

            MyArray(i, 1) = vbLf
        End If '
   
   
        MyArray(i, 1) = Replace(MyArray(i, 1), "*", vbLf)
        MyArray(i, 1) = Replace(MyArray(i, 1), "Sum", vbLf, vbTextCompare)
        MyArray(i, 1) = Replace(MyArray(i, 1), "sum", vbLf, vbTextCompare)
        MyArray(i, 1) = Replace(MyArray(i, 1), "SUM", vbLf, vbTextCompare)
    
        MyArray(i, 1) = Replace(MyArray(i, 1), "[", "")
        MyArray(i, 1) = Replace(MyArray(i, 1), "]", "")
        MyArray(i, 1) = Replace(MyArray(i, 1), "(", vbLf)
        MyArray(i, 1) = Replace(MyArray(i, 1), ")", vbLf)
        MyArray(i, 1) = Replace(MyArray(i, 1), "+", vbLf)
        MyArray(i, 1) = Replace(MyArray(i, 1), "-", vbLf)
    
        MyArray(i, 1) = Replace(MyArray(i, 1), "/", vbLf)
    
        MyArray(i, 1) = Replace(MyArray(i, 1), " ", "")

    
        MyArray(i, 1) = Replace(MyArray(i, 1), "(", vbLf)
        MyArray(i, 1) = Replace(MyArray(i, 1), ")", vbLf)
        MyArray(i, 1) = Replace(MyArray(i, 1), "[", vbLf)
        MyArray(i, 1) = Replace(MyArray(i, 1), "]", vbLf)
        'MyArray(i, 1) = Replace(MyArray(i, 1), "100 " + vbLf, vbLf)
        MyArray(i, 1) = Replace(MyArray(i, 1), "100", vbLf)
        MyArray(i, 1) = Replace(MyArray(i, 1), "+", vbLf)
        MyArray(i, 1) = Replace(MyArray(i, 1), "~*", vbLf)
        MyArray(i, 1) = Replace(MyArray(i, 1), "Sum", vbLf)
        MyArray(i, 1) = Replace(MyArray(i, 1), "*", vbLf)
        MyArray(i, 1) = Replace(MyArray(i, 1), "/", vbLf)
        MyArray(i, 1) = Replace(MyArray(i, 1), "-", vbLf)

        MyArray(i, 1) = Replace(MyArray(i, 1), "^[0-9]", vbLf)
    
    Next i

    
    
    
    da.Range(da.Cells(1, 15), da.Cells(COUNT, 15)) = MyArray
   
 


End Sub



'半角スペース削除()
'O列の幅を調整
Public Sub 半角スペース削除()

    With Worksheets("date").Columns("O")
        .Replace what:=" ", replacement:="", LookAt:=xlPart '：部分一致（ LookAt:=xlPart
        .AutoFit
    End With

End Sub


'O列の幅を調整
Public Sub O列の幅を調整()

    With Worksheets("date").Columns("O")
        .AutoFit
    End With

End Sub

'整形

Public Sub データ削除試作品()
    With Worksheets("date")
        Dim arr As Variant
    
        For Each arr In Array("[0-9] ")
            Columns("O").Replace what:=arr, replacement:="", LookAt:=xlPart
        Next
    
    
        For Each arr In Array("+", "-", "~*", "/", ":", "~?", "[", "]", "Sum", "(", ")")
            Columns("O").Replace what:=arr, replacement:="", LookAt:=xlPart
        Next
    End With

End Sub


'Excel VBA 区切った文字数分の行挿入して一覧を作成する

Public Sub Sample1()

Dim i       As Long
Dim n       As Long
Dim MaxRow  As Long
Dim MyStr   As String
Dim temp    As Variant
Dim AddRow  As Long

'最終行を取得する
MaxRow = Cells(Rows.COUNT, 1).End(xlUp).Row

'行を挿入する場合は下から
For i = MaxRow To 2 Step -1
    
    '分解したいセルを指定する
    MyStr = Cells(i, 15)
    
    ',で区切って変数に格納する
    temp = Split(MyStr, "・")
    
    '区切った要素数を取得する
    AddRow = UBound(temp)
    
    '行挿入の際に要素数0だとエラーになるので判定する
    If AddRow > 0 Then
        
        '要素数分行挿入する
        Range("A" & i + 1).Resize(AddRow).EntireRow.Insert
        
    End If
     
    '要素数分ループして基準となる項目を反映して、区切った文字列を入力する
    For n = 0 To AddRow
    
        Cells(i + n, 1) = Cells(i, 1)
        Cells(i + n, 2) = temp(n)
    
    Next n

Next i

End Sub

'空白行を削除し詰める

Public Sub CommandButton1_Click()
    Dim i As Long
    Dim toprow As Long
    Dim bottomrow As Long
    
    '開始する行
    toprow = 8
    '終了する行
    bottomrow = 30
    
    For i = bottomrow To toprow Step -1
        If ActiveSheet.Cells(i, 1) = "" Then
            'A列が空白なら行削除
            Application.Rows(i).Delete
        End If
    Next
End Sub

'シートがあるかどうか調べて、ある場合はそのシートを削除
Sub Delete_sheet()
    Dim ws As Worksheet
    Dim flag As Boolean
    
    For Each ws In Worksheets
        If ws.Name = "date" Then flag = True
    Next ws
    If flag = True Then
        Application.DisplayAlerts = False
        Worksheets("date").Delete
        Application.DisplayAlerts = True
    
    End If
End Sub


Sub データ削除()
   With Worksheets("date").Columns("O")
        .Replace what:="~*", replacement:=vbLf, LookAt:=xlPart '：部分一致（ LookAt:=xlPart）
        .Replace what:="~?", replacement:=vbLf, LookAt:=xlPart '：部分一致（ LookAt:=xlPart）
        .Replace what:="+", replacement:=vbLf, LookAt:=xlPart '：部分一致（ LookAt:=xlPart）
        .Replace what:="+ ", replacement:=vbLf, LookAt:=xlPart '：部分一致（ LookAt:=xlPart）
        .Replace what:="-", replacement:=vbLf, LookAt:=xlPart '：部分一致（ LookAt:=xlPart）
        .Replace what:="- ", replacement:=vbLf, LookAt:=xlPart '：部分一致（ LookAt:=xlPart）
        .Replace what:="[", replacement:="", LookAt:=xlPart '：部分一致（ LookAt:=xlPart）
        .Replace what:="]", replacement:="", LookAt:=xlPart '：部分一致（ LookAt:=xlPart）
        .Replace what:="/", replacement:="", LookAt:=xlPart '：部分一致（ LookAt:=xlPart）
        .Replace what:="100  Sum", replacement:="", LookAt:=xlPart '：部分一致（ LookAt:=xlPart）
        .Replace what:="100 ", replacement:="", LookAt:=xlPart '：部分一致（ LookAt:=xlPart）
        .Replace what:="Sum", replacement:="", LookAt:=xlPart '：部分一致（ LookAt:=xlPart）
        .Replace what:="(", replacement:="", LookAt:=xlPart '：部分一致（ LookAt:=xlPart）
        .Replace what:=")", replacement:="", LookAt:=xlPart '：部分一致（ LookAt:=xlPart）
        .Replace what:=" ATT_", replacement:="ATT_", LookAt:=xlPart '：部分一致（ LookAt:=xlPart）

        .Replace what:="NR_5201a", replacement:="", LookAt:=xlWhole '：完全一致（ LookAt:=xlWhole）
        .Replace what:="5G ", replacement:="", LookAt:=xlWhole '：完全一致（ LookAt:=xlWhole）
        .Replace what:="SA ", replacement:="", LookAt:=xlWhole '：完全一致（ LookAt:=xlWhole）
        .Replace what:="Inter", replacement:="", LookAt:=xlWhole '：完全一致（ LookAt:=xlWhole）
        .Replace what:="frequency ", replacement:="", LookAt:=xlWhole '：完全一致（ LookAt:=xlWhole）
        .Replace what:="execution ", replacement:="", LookAt:=xlWhole '：完全一致（ LookAt:=xlWhole）
        .Replace what:="attempts ", replacement:="", LookAt:=xlWhole '：完全一致（ LookAt:=xlWhole）
        .Replace what:="per PLMN", replacement:="", LookAt:=xlWhole '：完全一致（ LookAt:=xlWhole）
        .Replace what:="intra ", replacement:="", LookAt:=xlWhole '：完全一致（ LookAt:=xlWhole）
        .Replace what:="DU handover", replacement:="", LookAt:=xlWhole '：完全一致（ LookAt:=xlWhole）
        .Replace what:="NR_5205a ", replacement:="", LookAt:=xlWhole '：完全一致（ LookAt:=xlWhole）
        .Replace what:="gNB handover for ", replacement:="", LookAt:=xlWhole '：完全一致（ LookAt:=xlWhole）


        .Replace what:="5G SA carrier aggregation RRC reconfiguration success", replacement:="", LookAt:=xlPart '：部分一致（ LookAt:=xlPart）

        .Replace what:="Where NR_106a is;", replacement:="", LookAt:=xlPart '：部分一致（ LookAt:=xlPart）

        .Replace what:="NR_1018a ", replacement:="", LookAt:=xlPart '：部分一致（ LookAt:=xlPart）
        .Replace what:="Number ", replacement:="", LookAt:=xlPart '：部分一致（ LookAt:=xlPart）
        .Replace what:="of ", replacement:="", LookAt:=xlPart '：部分一致（ LookAt:=xlPart）
        .Replace what:="handover ", replacement:="", LookAt:=xlPart '：部分一致（ LookAt:=xlPart）
        .Replace what:="per ", replacement:="", LookAt:=xlPart '：部分一致（ LookAt:=xlPart）
        .Replace what:="neighbour ", replacement:="", LookAt:=xlPart '：部分一致（ LookAt:=xlPart）
        .Replace what:="cell relation", replacement:="", LookAt:=xlPart '：部分一致（ LookAt:=xlPart）


        .Replace what:="NR_5201a 5G SA Interfrequency intraDU handover execution attempts per PLMN  NR_5205a 5G SA interfrequency intergNB handover execution attempts for SA per PLMN+", replacement:="", LookAt:=xlPart '：部分一致（ LookAt:=xlPart）
        .Replace what:="5G SA Handover execution success per neighbour cell relation", replacement:="", LookAt:=xlPart '：部分一致（ LookAt:=xlPart）
        
                
        .Replace what:="114 ", replacement:="", LookAt:=xlPart '：部分一致（ LookAt:=xlPart）
        .Replace what:="114 ", replacement:="", LookAt:=xlPart '：部分一致（ LookAt:=xlPart）
        .Replace what:="113 ", replacement:="", LookAt:=xlPart '：部分一致（ LookAt:=xlPart）
        .Replace what:="112 ", replacement:="", LookAt:=xlPart '：部分一致（ LookAt:=xlPart）
        .Replace what:="111 ", replacement:="", LookAt:=xlPart '：部分一致（ LookAt:=xlPart）
        .Replace what:="110 ", replacement:="", LookAt:=xlPart '：部分一致（ LookAt:=xlPart）
        .Replace what:="11 ", replacement:="", LookAt:=xlPart '：部分一致（ LookAt:=xlPart）
        .Replace what:="109 ", replacement:="", LookAt:=xlPart '：部分一致（ LookAt:=xlPart）
        .Replace what:="108 ", replacement:="", LookAt:=xlPart '：部分一致（ LookAt:=xlPart）
        .Replace what:="107 ", replacement:="", LookAt:=xlPart '：部分一致（ LookAt:=xlPart）
        .Replace what:="106 ", replacement:="", LookAt:=xlPart '：部分一致（ LookAt:=xlPart）
        .Replace what:="105 ", replacement:="", LookAt:=xlPart '：部分一致（ LookAt:=xlPart）
        .Replace what:="104 ", replacement:="", LookAt:=xlPart '：部分一致（ LookAt:=xlPart）
        .Replace what:="103 ", replacement:="", LookAt:=xlPart '：部分一致（ LookAt:=xlPart）
        .Replace what:="102 ", replacement:="", LookAt:=xlPart '：部分一致（ LookAt:=xlPart）
        .Replace what:="101 ", replacement:="", LookAt:=xlPart '：部分一致（ LookAt:=xlPart）
        .Replace what:="100 ", replacement:="", LookAt:=xlPart '：部分一致（ LookAt:=xlPart）
        .Replace what:="99 ", replacement:="", LookAt:=xlPart '：部分一致（ LookAt:=xlPart）
        .Replace what:="98 ", replacement:="", LookAt:=xlPart '：部分一致（ LookAt:=xlPart）
        .Replace what:="97 ", replacement:="", LookAt:=xlPart '：部分一致（ LookAt:=xlPart）
        .Replace what:="96 ", replacement:="", LookAt:=xlPart '：部分一致（ LookAt:=xlPart）
        .Replace what:="95 ", replacement:="", LookAt:=xlPart '：部分一致（ LookAt:=xlPart）
        .Replace what:="95 ", replacement:="", LookAt:=xlPart '：部分一致（ LookAt:=xlPart）
        .Replace what:="93 ", replacement:="", LookAt:=xlPart '：部分一致（ LookAt:=xlPart）
        .Replace what:="92 ", replacement:="", LookAt:=xlPart '：部分一致（ LookAt:=xlPart）
        .Replace what:="91 ", replacement:="", LookAt:=xlPart '：部分一致（ LookAt:=xlPart）

        .Replace what:="9 ", replacement:="", LookAt:=xlPart '：部分一致（ LookAt:=xlPart）
        .Replace what:="8 ", replacement:="", LookAt:=xlPart '：部分一致（ LookAt:=xlPart）
        .Replace what:="7 ", replacement:="", LookAt:=xlPart '：部分一致（ LookAt:=xlPart）
        .Replace what:="6 ", replacement:="", LookAt:=xlPart '：部分一致（ LookAt:=xlPart）
        .Replace what:="5 ", replacement:="", LookAt:=xlPart '：部分一致（ LookAt:=xlPart）
        .Replace what:="4 ", replacement:="", LookAt:=xlPart '：部分一致（ LookAt:=xlPart）
        .Replace what:="3 ", replacement:="", LookAt:=xlPart '：部分一致（ LookAt:=xlPart）
        .Replace what:="2 ", replacement:="", LookAt:=xlPart '：部分一致（ LookAt:=xlPart）
        .Replace what:="1 ", replacement:="", LookAt:=xlPart '：部分一致（ LookAt:=xlPart）

    End With
End Sub
