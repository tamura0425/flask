Public Sub MakiGraph()

'###変数定義###

'グラフ作成用ループカウンター
Dim i As Long
'項目名用ループカウンター
Dim x As Long
Dim j As Long

'ワークシート処理用
Dim WS As Worksheet
'最終行取得
Dim EndRow As Long
'最終列取得
Dim EndCol As Long
'ワークシート代入用変数
Dim sh As Worksheet

'データ加工用変数

Dim d As String
'データ加工用変数
Dim str As String
'データ加工用変数
Dim strCell As String
'データ加工用変数
Dim strTitle As String
'データ加工用変数
Dim strJoin As String





'データ加工用変数
Dim strDay As String
'データ加工用変数
Dim strtime As String


'ループ用
Dim ab As Long


'グラフ作成用ループカウンター
Dim aa As Long

str = "CELL_"
'「graph」の有無を確認しなければ作成しデータを削除
For Each WS In Worksheets

    If WS.Name = "graph" Then
        Application.DisplayAlerts = False
        WS.Delete
        Application.DisplayAlerts = True
        Exit For
    End If
Next WS





'ワークシートアクティブ
Worksheets.Add
ActiveSheet.Name = "graph"
Sheets("graph").Activate

'シート指定用変数
Set sh = Sheets("data")


'範囲指定用処理
Dim First_Row As Long
Dim Lost_Row As Long

With sh
    If Not .AutoFilterMode Then Exit Sub
    With Intersect(.AutoFilter.Range.Resize(.AutoFilter.Range.Rows.Count - 1).Offset(1), .Columns("B")).SpecialCells(xlCellTypeVisible)
        First_Row = .Areas(1).Row
        Lost_Row = .Areas(.Areas.Count).Rows(.Areas(.Areas.Count).Rows.Count).Row
    End With
End With


Dim Start_Row As Long
Dim Save_Box As Long
Dim Finish As Long

Dim Count As Long

'###########グラフ作成
'初期値　セル[F1]の No1_接続成功率(発信＋着信)から開始するため
'グラフ作成に必要な最終列を取得
EndCol = sh.Cells(2, Columns.Count).End(xlToLeft).Column
'外ループグラフを一項目づつ作成するためのループ

x = 6
'グラフ加工用処理
d = "   "

For i = 2 To EndCol

'内ループ
    'First_Row To
    For j = First_Row To Lost_Row


        'グラフタイトル加工用処理
        strCell = sh.Cells(2, 2).Text
        strTitle = sh.Cells(1, x).Text
        strJoin = str + strCell + d + strTitle
        'グラフ位置変動用
        Count = 2
        Start_Row = First_Row
        
        If sh.Cells(j, x) = sh.Cells(j + 1, x) Then
                '一致すれば何もしない
        
        Else
        'グラフ作成
            With ActiveSheet.Shapes.AddChart.Chart
            
                'グラフ種類設定
                .ChartType = xlLine
                
                'グラフ範囲指定
    
                .SetSourceData Source:=Union(sh.Range(sh.Cells(Start_Row, 4), sh.Cells(j, 4)), _
                sh.Range((sh.Cells(Start_Row, x)), sh.Cells(j, x)))
                
                
                
                'グラフタイトル表示
                .HasTitle = True
                
                'タイトル文字列設定
                '.ChartTitle.Text = sh.Cells(1, x)
                .ChartTitle.Text = strJoin
    
    
                '凡例を削除
                .Legend.Delete
                
                'グラフ位置の設定
                .Parent.Top = Range("B" & ((Count - 2) * 28 + 2)).Top
                .Parent.Left = Range("B" & ((Count - 2) * 15 + 2)).Left
                
            End With
                
            'グラフサイズ設定
            With ActiveSheet.ChartObjects
                .Height = 400
                .Width = 1250
            End With
        End If
        
        
    'グラフ項目移動用カウンター
      x = x + 1
      
      Count = Count + 1
     Next j
     
      'Start_Row = j
      
      'グラフ項目移動用カウンター　初期化
     x = 6
     

Next i
'ループ終了

    '###シート位置変更###
    
    'graphシートを一番左に移動
    Worksheets("graph").Move Before:=Worksheets(1)
    
    'linegraph_createシートを一番右に移動
    Worksheets("起動ボタン").Move After:=Worksheets(Worksheets.Count)
    
    'graphシートを前面表示
    Sheets("graph").Select
    
MsgBox "完了しました"


End Sub


Sub Sample2()



     
    
End Sub


'######
   



'
'Function Func1() As Long
'    Dim count As Long
'    Dim error As Long
'    Dim test As Long
'
'      With ActiveSheet
'        If Not .AutoFilterMode Then Exit Function
'        With Intersect(.AutoFilter.Range.Resize(.AutoFilter.Range.Rows.count - 1).Offset(1), .Columns("B")).SpecialCells(xlCellTypeVisible)
'           Debug.Print .Areas(1).Rows(1).Address
'           Debug.Print .Areas(.Areas.count).Rows(.Areas(.Areas.count).Rows.count).Address
'
'        End With
'      End With
'End Function





'Sub Sample1() '＃＃＃＃＃エラー検索
''
''
''    EndRow = Cells(2, 84).End(xlDown).Row
''
''    For i = 1 To EndRow
''
''        If Len(Cells(i, 84).Value) = 0 Then
''
''         flag = 1
''
''        End If
''    Next i
''
''
''
''        If flag = 1 Then
''
''            MsgBox "エラーです"
''
''
''        End If
''
''    Dim l As Long
''l = Range("CF1").Row ' 3
''Debug.Print (l)
''
'
'
'End Sub




