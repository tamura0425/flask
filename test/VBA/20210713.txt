Public Sub MakiGraph()

'###変数定義###

'グラフ作成用ループカウンター
Dim i As Long
'項目名用ループカウンター
Dim x As Long
'ワークシート処理用
Dim WS As Worksheet
'最終行取得
Dim EndRow As Long
'最終列取得
Dim EndCol As Long
'ワークシート代入用変数
Dim sh As Worksheet

'データ加工用変数

Dim d As String
'データ加工用変数
Dim str As String
'データ加工用変数
Dim strCell As String
'データ加工用変数
Dim strTitle As String
'データ加工用変数
Dim strJoin As String



'データ加工用変数
Dim strDay As String
'データ加工用変数
Dim strtime As String


'ループ用
Dim ab As Long


'グラフ作成用ループカウンター
Dim aa As Long

str = "CELL_"
'「graph」の有無を確認しなければ作成しデータを削除
For Each WS In Worksheets

    If WS.Name = "graph" Then
        Application.DisplayAlerts = False
        WS.Delete
        Application.DisplayAlerts = True
        Exit For
    End If
Next WS



'範囲指定用処理
Dim First_Row As Long
Dim Lost_Row As Long

    With ActiveSheet
        'If Not .AutoFilterMode Then Exit Function
        With Intersect(.AutoFilter.Range.Resize(.AutoFilter.Range.Rows.count - 1).Offset(1), .Columns("B")).SpecialCells(xlCellTypeVisible)
        'Debug.Print .Areas(1).Rows(1).Address
        'Debug.Print .Areas(.Areas.count).Rows(.Areas(.Areas.count).Rows.count).Address
        
        First_Row = .Areas(1).Row
        Lost_Row = .Areas(.Areas.count).Rows(.Areas(.Areas.count).Rows.count).Row
        
        MsgBox First_Row
        MsgBox Lost_Row
    
    End With
End With



'ワークシートアクティブ
Worksheets.Add
ActiveSheet.Name = "graph"
Sheets("graph").Activate

'シート指定用変数
Set sh = Sheets("data")



Dim OK As Long
Dim NG As Long

'For aa = First_Row To Lost_Row
'
'    If sh.Cells(aa, 2) = sh.Cells(aa + 1, 2) Then
'        OK = OK + 1
'        MsgBox aa
'    Else
'        NG = NG + 1
'    End If
'
'Next aa
'MsgBox OK
'MsgBox NG



'###########グラフ作成
'初期値　セル[F1]の No1_接続成功率(発信＋着信)から開始するため

'グラフ作成に必要な最終列を取得


EndCol = sh.Cells(2, Columns.count).End(xlToLeft).Column

x = 6

'グラフ加工用処理
d = "   "

'グラフを一項目づつ作成するためのループ
For i = 2 To EndCol
    'グラフ作成を行うためシートを活性


'グラフタイトル加工用処理
strCell = sh.Cells(2, 2).Text
strTitle = sh.Cells(1, x).Text
strJoin = str + strCell + d + strTitle



'
'First_Row
'Lost_Row
'内ループ

    'First_Row To Lost_Row
    'グラフ作成
        With ActiveSheet.Shapes.AddChart.Chart
      
            'グラフ種類設定
            .ChartType = xlLine
            
            'グラフ範囲指定
'            .SetSourceData Source:=Union(sh.Range(sh.Range("D2"), sh.Cells(Rows.count, 4).End(xlUp)), _
'            sh.Range((sh.Cells(2, x)), sh.Cells(Rows.count, x).End(xlUp)))
'
                        .SetSourceData Source:=Union(sh.Range(sh.Cells(First_Row, 4), sh.Cells(Lost_Row, 4)), _
            sh.Range((sh.Cells(First_Row, x)), sh.Cells(Lost_Row, x)))
'
            
            'グラフタイトル表示
            .HasTitle = True
            
            'タイトル文字列設定
            '.ChartTitle.Text = sh.Cells(1, x)
            .ChartTitle.Text = strJoin


            '凡例を削除
            .Legend.Delete
            
            'グラフ位置の設定
            .Parent.Top = Range("B" & ((i - 2) * 20 + 2)).Top
            .Parent.Left = Range("B" & ((i - 2) * 15 + 2)).Left
            
            

'            If Sheets("linegraph_create").CheckBox1.Value = True Then
'             .SetElement (msoElementDataLabelTop)
'            End If
'
'
'            If Sheets("linegraph_create").CheckBox2.Value = True Then
'             .HasLegend = True
'            End If
        'グラフ作成用
        End With
        


            
        'グラフサイズ設定
        With ActiveSheet.ChartObjects
            .Height = 300
            .Width = 1200

        End With

'グラフ項目移動用カウンター
x = x + 1
Next i
'ループ終了

End Sub


Sub Sample2()


    '###シート位置変更###
    
    'graphシートを一番左に移動
    Worksheets("graph").Move Before:=Worksheets(1)
    
    'linegraph_createシートを一番右に移動
    Worksheets("linegraph_create").Move After:=Worksheets(Worksheets.count)
    
    'graphシートを前面表示
    Sheets("graph").Select
    
     MsgBox "完了しました"
    
End Sub


'######
   



'
'Function Func1() As Long
'    Dim count As Long
'    Dim error As Long
'    Dim test As Long
'
'      With ActiveSheet
'        If Not .AutoFilterMode Then Exit Function
'        With Intersect(.AutoFilter.Range.Resize(.AutoFilter.Range.Rows.count - 1).Offset(1), .Columns("B")).SpecialCells(xlCellTypeVisible)
'           Debug.Print .Areas(1).Rows(1).Address
'           Debug.Print .Areas(.Areas.count).Rows(.Areas(.Areas.count).Rows.count).Address
'
'        End With
'      End With
'End Function





'Sub Sample1() '＃＃＃＃＃エラー検索
''
''
''    EndRow = Cells(2, 84).End(xlDown).Row
''
''    For i = 1 To EndRow
''
''        If Len(Cells(i, 84).Value) = 0 Then
''
''         flag = 1
''
''        End If
''    Next i
''
''
''
''        If flag = 1 Then
''
''            MsgBox "エラーです"
''
''
''        End If
''
''    Dim l As Long
''l = Range("CF1").Row ' 3
''Debug.Print (l)
''
'
'
'End Sub

