Option Explicit
Dim MaxRow As Long
Dim MaxCol As Long
Dim buf As String
Dim i As Long
Dim ws As Worksheet

Sub linegraph_create()

Application.ScreenUpdating = False '画面更新表示

'グラフシートが既にあれば、削除する
For Each ws In Worksheets
        If ws.Name = "graph" Then
            Application.DisplayAlerts = False
            ws.Delete
            Application.DisplayAlerts = True
            Exit For
        End If
Next ws

'グラフシート作成
Worksheets.Add
ActiveSheet.Name = "graph"

Sheets("data").Activate
MaxRow = Range("A2").End(xlDown).Row '最終行取得
MaxCol = Range("B2").End(xlToRight).Column '最終列取得

'列のアルファベット取得
buf = Cells(1, MaxCol).Address(True, False)
buf = Left(buf, InStr(buf, "$") - 1)
    

For i = 2 To MaxRow
    'グラフを生成する
    Sheets("graph").Activate
    
    If Sheets("linegraph_create").CheckBox3.Value = True Then
        ActiveSheet.Shapes.AddChart2(332, xlLineMarkers).Select 'マーカー付き
    Else
        ActiveSheet.Shapes.AddChart2(227, xlLine).Select 'マーカーなし
    End If

    With ActiveChart
    
        .SetSourceData Source:=Union(Range("data!$A$1:$" & buf & "$1"), Range("data!$a$" & i & ":$" & buf & "$" & i & ""))

        
        
        '.SetSourceData Source:=Range("data!$A$1:$" & buf & "$1,data!$c$" & i & ":$" & buf & "$" & i & "")
        
        
        .ChartTitle.Text = Sheets("data").Range("A" & i) & " " & Sheets("data").Range("A1")
        
        
        .Parent.Top = Range("B" & ((i - 2) * 15 + 1)).Top
        .Parent.Left = Range("B" & ((i - 2) * 15 + 1)).Left
        'データラベル追加
        If Sheets("linegraph_create").CheckBox1.Value = True Then
            .SetElement (msoElementDataLabelTop)
        End If
        '凡例追加
        If Sheets("linegraph_create").CheckBox2.Value = True Then
            .HasLegend = True
        End If
    End With

Next i
Range("A1").Select

Sheets("linegraph_create").Activate
Application.ScreenUpdating = True '画面更新表示
MsgBox "完了しました"


End Sub



